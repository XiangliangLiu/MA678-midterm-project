---
title: "Airbnb Mitderm "
author: "Xiangliang Liu"
output:
  html_document: default
  pdf_document: default
---
##Abstract
Nowadays, as the development of tourism, more and more people are willing to spend money traveling around the world. Airbnb is one of the good choice for travelers to find appropriate accomodation to meet different requirements. This report will mainly focus on predicting the price of different rooms on the Airbnb website. Specifically, the report will do analysis on Airbnb data with two method: EDA(Exploratory Data Analysis) and modeling. After reading this report, you will have a general idea how to predict the price of rooms on Airbnb website and what's the most influential factor in predicting process.

##Introduction
This project will be focusing on the analysis on the relationship betweeen price and other factors on AirBnb website. Airbnb is a privately held global company headquartered in San Francisco that operates an online marketplace and hospitality service which is accessible via its websites and mobile apps. Members can use the service to arrange or offer lodging, primarily homestays, or tourism experiences. The data was extracted from http://tomslee.net, which can also be extracted from official AirBnb website. Specifically, the data was collected from the September 2014 to July 2017 in Boston area. The whole project will consist of following parts "abstract","introduction",, "discussion and visualization", "modeling","conclusion and summary", "reference". I will fitst read in the data and do some visualization to see which predictor will contributes more to the prediction of price and rating.And then the modeling will be conducting multii-level regression using room type and neighborhood as factors to predict price and rating.


```{r echo=FALSE, message=FALSE, warning=FALSE}
#load packages
library(readr)
library(ggplot2)
library(tidyverse)
library(sqldf)
library(knitr)
library(kableExtra)
library(lme4)
library(arm)
library(coefplot)
library(dplyr)
```

```{r message=FALSE, echo=FALSE, warning=FALSE}
#read in data and combine the them to a whole data set
data1<- read_csv("tomslee_airbnb_boston_0054_2014-09-24.csv")
data2<- read_csv("tomslee_airbnb_boston_0079_2015-01-18.csv")
data3<- read_csv("tomslee_airbnb_boston_0120_2015-07-07.csv")
data4<- read_csv("tomslee_airbnb_boston_0210_2015-11-21.csv")
data5<- read_csv("tomslee_airbnb_boston_0235_2015-12-14.csv")
data6<- read_csv("tomslee_airbnb_boston_0282_2016-01-16.csv")
data7<- read_csv("tomslee_airbnb_boston_0314_2016-02-16.csv")
data8<- read_csv("tomslee_airbnb_boston_0344_2016-03-18.csv")
data9<- read_csv("tomslee_airbnb_boston_0386_2016-04-14.csv")
data10<-read_csv("tomslee_airbnb_boston_0420_2016-05-18.csv")
data11<-read_csv("tomslee_airbnb_boston_0461_2016-06-18.csv")
data12<-read_csv("tomslee_airbnb_boston_0489_2016-07-16.csv")
data13<-read_csv("tomslee_airbnb_boston_0524_2016-08-19.csv")
data14<-read_csv("tomslee_airbnb_boston_0566_2016-09-16.csv")
data15<-read_csv("tomslee_airbnb_boston_0610_2016-10-18.csv")
data16<-read_csv("tomslee_airbnb_boston_0649_2016-11-21.csv")
data17<-read_csv("tomslee_airbnb_boston_0779_2017-01-14.csv")
data18<-read_csv("tomslee_airbnb_boston_0858_2017-02-16.csv")
data19<-read_csv("tomslee_airbnb_boston_0931_2017-03-12.csv")
data20<-read_csv("tomslee_airbnb_boston_1043_2017-04-08.csv")
data21<-read_csv("tomslee_airbnb_boston_1187_2017-05-05.csv")
data22<-read_csv("tomslee_airbnb_boston_1309_2017-06-10.csv")
data23<-read_csv("tomslee_airbnb_boston_1429_2017-07-10.csv")
# There are 23 datasets collected in different period. We used row bind to join all the datasets together. 
total = dplyr::bind_rows(data1,data2,data3, data4, data5, data6, data7, data8, data9,data10,data11, data12, data13, data14, data15, data16,data17, data18, data19,data20, data21,data22, data23)
```

###overview of Airbnb data:
```{r}
kable(head(total))
```

###Data cleaning
There are 10 variales that will be used in this project. Specifically,they are room id, host, id room type, neighborhood, number of reviews, overall satisfaction(rating), number of accommodates, number of bedrooms and minimum stay for a visit those will be the potential factors to influence the pricing.

The following table includes some of the features of the dataset:
```{r echo=FALSE}
#specify the column
Airbnb = total[,c(1:3,5:13)]
summary(Airbnb)#check the summary of the data:
BostonAirbnb = na.omit(Airbnb)#eliminate all the NA value.
```
*According to the summary we can see there are some missing values in the column of host_id, overvall_statisfaction, accommodates, bedrooms and minstay.*

*After eliminating al the miss values, we filtered the data with 0 reviews, or price = 0. the observation is meaningless if it has 0 value in number of reviews and price*
```{r include=FALSE}
BostonAirbnb <- BostonAirbnb %>%
  filter(BostonAirbnb$reviews > 0)%>%
  filter(BostonAirbnb$price > 0)
BostonAirbnb$room_id = as.character(BostonAirbnb$room_id)
BostonAirbnb$host_id = as.character(BostonAirbnb$host_id)
length(BostonAirbnb$price)
# the size of cleaned observation is 25513
summary(BostonAirbnb)#Now check the summary of data, There's no missing value in the data and the range of data is reasonable.
```

##Method
###discussion and visualization:
```{r}
#catagorical data:
kable(table(BostonAirbnb$room_type))
kable(table(BostonAirbnb$neighborhood))
```

Distribution of number of reviews
```{r echo=FALSE}
hist(BostonAirbnb$reviews, main = "distribution of number of reviews", xlab = "number of review")
```
*as we can see from the distribution plot of number of reviews, most of airbnb hosts have less than 100 reviews.*

Distibution of overall satisfaction:
```{r}
hist(BostonAirbnb$overall_satisfaction, main = "distribution of overall satisfaction", xlab = "overall_satisfaction")
```
*in th histgram plot, most of overall rating is aroud 4.5 and 5. There are also a small portion of people rate the room 4 star. Overall, customers are satisfied with most of rooms in boston area*


Number of room, pricing and average rating with different district:
```{r include=FALSE}
Rating<-sqldf("SELECT overall_satisfaction, COUNT (room_id) FROM BostonAirbnb Group by 1")
colnames(Rating)<-c("rating","Num_room")

#create a new dataset called district.
district<-sqldf("SELECT neighborhood, COUNT (room_id), Avg(overall_satisfaction),avg(price),avg(reviews), Avg(longitude), Avg(latitude) FROM BostonAirbnb Group by 1")

#rename the column of the dataset.
colnames(district)<-c("district","Num_room", "Avg_rating","Avg_price", "reviews","lon", "lat")
```

```{r echo=FALSE}
ggplot(data=district, aes(x=reorder(district,-reviews), y= reviews))+geom_bar(stat = "identity", fill = "sky blue") + ggtitle("Average number of reviews per District")+ylab("Average nmber of reviews") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
*From this plot, the district Longwood Medical area has the highest number of review (around 78), while Fenway has the lowest average number of reviews in Boston area(around 15). So the average number of review do varys a lot by district.*
```{r echo=FALSE}
ggplot(data=district, aes(x=reorder(district,-Avg_rating), y= Avg_rating))+geom_bar(stat = "identity", fill = "sky blue") + ggtitle("Average rating of Airbnb Rooms per District")+ylab("Average rating of room") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
#
```
*As the graph showing below, we can't tell significant diffence of rating among different neighborhoods. But we can see Leather District has highest average rating which is close to 5.So neighborhood of the Airbnb room could be an influence predictor. We might want to include this predictor in the model to see whether rating is a significant for predicting price of rooms.*

Average rating and price with different room types.
```{r echo=FALSE}
room_type <- sqldf("SELECT room_type, count(room_id), Avg(overall_satisfaction), avg(price) FROM BostonAirbnb Group by 1")
colnames(room_type) = c("room_type","Num_room", "Avg_rating","Avg_price")
ggplot(data = room_type, aes(x= reorder(room_type,-Avg_price),y = Avg_price)) + geom_bar(stat = "identity", fill = "sky blue") + ggtitle("Average price with different room types") + ylab("average price") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
*From the plot below we can see entire home/Apt have highest average price among all types of room. This result is reasonable because entire home/apt have more space that can serve more people, so the price is higer.*
```{r echo=FALSE}
ggplot(data = BostonAirbnb, aes(overall_satisfaction,fill = room_type)) + geom_bar(position  = "fill") + ggtitle("Average rating with different room types") + ylab("Percentage") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
*The the plot showing above indicates the proportion of room types in different score of rating. We can tell from the graph that when overall_satisfaction = 1 share room has relatively larger proportion compared situations when rating equal other values. However, we can't tell that "Entire home/apt" have higher proportion than other room type, because we found in previous EDA that The number of entire home/apt is higher than either private room or shared room.*


The accommodates and bedrooms could be two correlated terms in the model, because the number of bedroom will limit the number of customer served. So the correlation test will be conduted in next step.

```{r echo=FALSE}
res <- cor.test(BostonAirbnb$accommodates, BostonAirbnb$bedrooms, 
                    method = "pearson")
res
```
*the p-value of this test is 2.2e-16. Reject the null hypothesis. So Correlation between the those two variables is signifiacant.*


Before going further, we want to test the distribution of the response variable--price, to test the assumption that it is normal distributed.
```{r echo=FALSE}
#create a histgram of the distribution of price from 0 to 700, since this range will be the morjority of price fall in. 
hist(BostonAirbnb$price, main = "Distribution of room price", xlab = "Price",breaks = 100,xlim = c(0,700))
#since the response varible, price is not normal distributed, we are going to do log transformation on this variable.
df <- BostonAirbnb%>%
  mutate(logprice = log(price))
hist(log(BostonAirbnb$price), main = "Distribution of room price", xlab = "Price", breaks = 40,xlim = c(2,8))
#The distribution  
```
*ZThe first histgram ditribution plot obviously dose not follow normal distribution. After doing the log transformation, we got the second histgram plot. Now it looks like it follows normal distribution.*

###Modelling:

####Model1: Simple linear regression:
log(price) =  \alpha + \beta_1* x_{room_type} +\beta_2* x_{reviews} + \beta_3* x_{reviews} +\beta_4*x_{accommodates*bedrooms} + \beta_5* x_{accommodates}+\beta_6* x_{bedrooms} +\beta_7* x_{minstay} 
```{r}
#model1 simple linear regression:
model1 = lm(logprice~ room_type + reviews + overall_satisfaction + accommodates*bedrooms + minstay , data = df) #We add "-1" to the regression formula to remove the constant term.
summary(model1)
coefplot(model1)
AIC(model1)
plot(model1,which =1)#create a residual plot.
```
*From this simple linear regression, I found the all of the predictors are significant. Also the R-squre in the model is 0.3, So the model is not well fitted. However, in the residual plot, There are some points having big residual: 18772, 2680 and 2631. Those price are very high that lead to huge residuals.The rest of points are symetrrically distributed around the line h = 0. In the qq-plot, we can see most dots in the middle falls on the line. However, the data have more extreme values on the tail of the distribution. So the model overestimates the low values and underestimate the high values.*

####Model2: Random intercept:
```{r}
model2 = lmer(logprice ~ room_type + reviews + overall_satisfaction + accommodates*bedrooms + (1|neighborhood), data = df)
display(model2)
coefplot(model2)
```

####Model3 : Random slope:
```{r}
model3 = lmer(logprice ~ room_type + reviews + overall_satisfaction + accommodates*bedrooms + (0+ reviews|neighborhood), data = df)
display(model3)
coefplot(model3)
```
####model4 : Random slope and random intercept.

```{r echo=FALSE}
model4 = lmer(logprice ~ scale(reviews,center = TRUE,scale = TRUE) + scale(overall_satisfaction) +  (1|neighborhood) + (0 + reviews|neighborhood), data = df)
display(model4)
```
anova test:
```{r}
anova(model2, model3, model4, refit = FALSE)
```

##Result:



##Discussion:


##Reference
http://tomslee.net
https://en.wikipedia.org/wiki/Airbnb

##Appendix
```{r}
ggplot(data = room_type, aes(x= reorder(room_type,-Avg_rating),y = Avg_rating)) + geom_bar(stat = "identity", fill = "sky blue") + ggtitle("Average rating with different room types") + ylab("average rating") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
* The graph above shows the average rating with different room types. However we can't tell any difference among those three types. This is because the overall rating in Boston area are all very hight(above 4.5).*
```{r}
ggplot(data=district, aes(x=reorder(district,-Avg_price), y=Avg_price))+geom_bar(stat = "identity", fill = "sky blue")+
ggtitle("Number of Airbnb Rooms per District")+ylab("Number of room")+ theme(axis.text.x = element_text(angle = 45, hjust = 1))
```